<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>é€ƒè’æ¨¡æ‹Ÿå™¨Â·å´‡ç¥¯åä¸‰å¹´</title>
<style>
    /* ================= æ ·å¼è¡¨ (æ— å˜åŒ–) ================= */
    * { margin: 0; padding: 0; box-sizing: border-box; outline: none; -webkit-tap-highlight-color: transparent; }
    body { background: #3D342F; font-family: "SimSun", "å®‹ä½“", serif; color: #2A211D; line-height: 1.6; padding: 10px; min-height: 100vh; }
    .container { max-width: 600px; margin: 0 auto; background: #D4C4A0; border: 3px double #8B7355; box-shadow: inset 0 0 10px rgba(0,0,0,0.3); position: relative; min-height: 95vh; display: flex; flex-direction: column; }
    .container::before { content: ""; position: absolute; top: 0; left: 0; right: 0; bottom: 0; background: url("data:image/svg+xml,%3Csvg width='100' height='100' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence baseFrequency='0.02'/%3E%3C/filter%3E%3Crect width='100' height='100' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E"); pointer-events: none; z-index: 0; }
    
    .header { background: #8B7355; color: #F5E7C9; padding: 12px; text-align: center; border-bottom: 2px solid #5C4A3A; position: relative; z-index: 1; }
    .date-info { font-size: 14px; margin-bottom: 5px; }
    .main-title { font-size: 20px; font-weight: bold; letter-spacing: 2px; }
    
    .section { margin: 12px; padding: 10px; background: #E8D9B5; border: 1px solid #8B7355; border-radius: 4px; position: relative; z-index: 1; transition: all 0.3s; }
    .section-title { background: #5C4A3A; color: #F5E7C9; padding: 6px 10px; font-size: 14px; font-weight: bold; margin: -10px -10px 10px -10px; border-bottom: 1px solid #8B7355; }
    
    .status-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; font-size: 12px; }
    .status-item { display: flex; justify-content: space-between; align-items: center; padding: 4px; background: #F5E7C9; border: 1px solid #8B7355; }
    .progress-bar { width: 60px; height: 8px; background: #8B7355; border: 1px solid #5C4A3A; display: inline-block; position: relative; }
    .progress-fill { height: 100%; background: #3D342F; transition: width 0.5s ease-in-out; }
    
    .asset-line { font-size: 13px; margin: 4px 0; padding: 4px; background: #F5E7C9; border-left: 3px solid #8B7355; display: flex; justify-content: space-between; }
    
    .event-box { background: #F5E7C9; border: 1px solid #8B7355; padding: 10px; margin: 8px 0; font-size: 15px; min-height: 120px; white-space: pre-wrap; opacity: 1; transition: opacity 0.3s ease; }
    .event-box.fade-out { opacity: 0; transform: translateY(-5px); }
    .event-box.fade-in { opacity: 1; transform: translateY(0); }
    
    .choice-buttons { display: grid; grid-template-columns: 1fr; gap: 8px; margin-top: 10px; }
    .choice-btn { background: #8B7355; color: #F5E7C9; border: 1px solid #5C4A3A; padding: 12px 12px; font-size: 14px; cursor: pointer; text-align: left; transition: all 0.2s; font-family: inherit; position: relative; overflow: hidden; font-weight: bold; }
    .choice-btn:active { background: #5C4A3A; transform: scale(0.98); }
    .choice-btn:disabled { opacity: 0.5; cursor: not-allowed; filter: grayscale(1); }

    .log-entry { font-size: 12px; padding: 6px; margin: 4px 0; background: #EDE5C7; border-bottom: 1px dotted #8B7355; animation: slideIn 0.3s ease; }
    @keyframes slideIn { from{opacity:0; transform:translateX(-10px)} to{opacity:1; transform:translateX(0)} }
    .log-time { color: #8B4513; font-weight: bold; margin-right: 5px; }
    
    .input-area { margin: 12px; padding: 10px; background: #8B7355; border: 1px solid #5C4A3A; position: relative; z-index: 2; margin-top: auto; }
    .command-input { width: 100%; padding: 10px; border: 1px solid #5C4A3A; background: #F5E7C9; font-family: inherit; font-size: 14px; }
    
    .weather-info { text-align: center; font-size: 12px; color: #5C4A3A; padding: 5px; background: #F5E7C9; border-bottom: 1px solid #8B7355; position: relative; z-index: 1; }

    .txt-dialogue { color: #8B0000; font-weight: bold; font-family: "KaiTi", "æ¥·ä½“", serif; } 
    .txt-bold { color: #B8860B; font-weight: bold; border-bottom: 1px dotted #8B4513; }
    
    .float-anim { position: fixed; font-weight: bold; font-size: 18px; pointer-events: none; animation: floatUp 2s forwards; z-index: 100; text-shadow: 1px 1px 0 #fff; }
    @keyframes floatUp { from { transform: translateY(0); opacity:1; } to { transform: translateY(-50px); opacity:0; } }

    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.85); z-index: 999; display: flex; align-items: center; justify-content: center; backdrop-filter: blur(2px); }
    .modal-box { background: #E8D9B5; border: 3px double #8B7355; padding: 25px; width: 85%; max-width: 350px; box-shadow: 0 10px 30px rgba(0,0,0,0.8); text-align: center; }
    .modal-title { font-size: 20px; font-weight: bold; margin-bottom: 20px; color: #5C4A3A; border-bottom: 1px solid #8B7355; padding-bottom: 10px; }
    .form-group { margin-bottom: 15px; text-align: left; }
    .form-group label { display: block; font-size: 12px; color: #5C4A3A; margin-bottom: 5px; font-weight: bold; }
    .form-group input { width: 100%; padding: 10px; border: 1px solid #8B7355; background: #F5E7C9; font-family: inherit; font-size: 14px; }
    .btn-start { width: 100%; padding: 12px; background: #8B4513; color: #F5E7C9; border: 1px solid #5C2F0D; cursor: pointer; font-weight: bold; margin-top: 10px; font-size: 16px; transition: 0.2s; }
    .btn-start:hover { background: #5C2F0D; transform: scale(1.02); }

    .loading-overlay { position: absolute; top:0; left:0; width:100%; height:100%; background:rgba(212, 196, 160, 0.8); z-index: 50; display: none; align-items: center; justify-content: center; color: #5C4A3A; font-weight: bold; font-size: 16px; flex-direction: column; gap: 10px; }
    .spinner { width: 20px; height: 20px; border: 3px solid #8B7355; border-top: 3px solid transparent; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>
</head>
<body>

    <div id="setup-modal" class="modal-overlay">
        <div class="modal-box">
            <div class="modal-title">ğŸ“œ é€ƒè’å·å®—Â·å¯</div>
            <div class="form-group">
                <label>API åœ°å€ (SiliconFlow/DeepSeek)</label>
                <input type="text" id="api-host" value="https://api.siliconflow.cn/v1">
            </div>
            <div class="form-group">
                <label>API Key (å¿…å¡«)</label>
                <input type="password" id="api-key" placeholder="sk-...">
            </div>
            <div class="form-group">
                <label>æ¨¡å‹åç§° (Model Name)</label>
                <input type="text" id="api-model" value="deepseek-ai/DeepSeek-V3">
            </div>
            <div class="form-group">
                <label>ä¸»è§’å§“å</label>
                <input type="text" id="player-name" value="é™ˆäºŒä¸«">
            </div>
            <button class="btn-start" onclick="Game.init()">æŒ‰æ‰‹å° (å¼€å§‹æ¸¸æˆ)</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <div class="date-info" id="date-display">å´‡ç¥¯åä¸‰å¹´å››æœˆåˆä¹</div>
            <div class="main-title">é€ƒè’æ¨¡æ‹Ÿå™¨</div>
        </div>
        
        <div class="weather-info" id="weather-display">
            æ™´è½¬å¤šäº‘ Â· æ°”æ¸©18â„ƒ Â· é€‚åˆèµ¶è·¯
        </div>

        <div class="section">
            <div class="section-title">ã€ä¸»æ§çŠ¶æ€ã€‘</div>
            <div class="status-grid">
                <div class="status-item">
                    <spanâ¤ï¸ ä½“è´¨</span>
                    <span style="font-weight:bold" id="txt-hp">35</span>
                    <span class="progress-bar"><span class="progress-fill" id="bar-hp" style="width: 35%"></span></span>
                </div>
                <div class="status-item">
                    <span>ğŸ§  æ™ºåŠ›</span>
                    <span style="font-weight:bold" id="txt-int">62</span>
                    <span class="progress-bar"><span class="progress-fill" id="bar-int" style="width: 62%"></span></span>
                </div>
                <div class="status-item">
                    <span>ğŸ˜¨ å‹åŠ›</span>
                    <span style="font-weight:bold" id="txt-stress">70</span>
                    <span class="progress-bar"><span class="progress-fill" id="bar-stress" style="width: 70%; background:#8B0000;"></span></span>
                </div>
                <div class="status-item">
                    <span>ğŸ‘ï¸ å£°æœ›</span>
                    <span style="font-weight:bold" id="txt-rep">-10</span>
                </div>
            </div>
        </div>

        <div class="section">
            <div class="section-title">ã€è¡Œå›Šèµ„äº§ã€‘</div>
            <div class="asset-line">
                <span>ğŸ’° ç¢é“¶</span> <span style="font-weight:bold" id="val-money">0.30 ä¸¤</span>
            </div>
            <div class="asset-line">
                <span>ğŸš ç³™ç±³</span> <span style="font-weight:bold; color:#8B4513;" id="val-grain">21.5 æ–¤</span>
            </div>
            <div class="asset-line">
                <span>âš ï¸ çŠ¶æ€</span> <span id="val-status">æš‚æ— å¼‚å¸¸</span>
            </div>
        </div>

        <div class="section" style="flex:1; display:flex; flex-direction:column;">
            <div class="section-title">ã€å½“å‰é­é‡ã€‘</div>
            <div id="loading-mask" class="loading-overlay">
                <div class="spinner"></div>
                <div>å‘½è¿æ¨æ¼”ä¸­...</div>
            </div>
            <div class="event-box" id="main-narrative">æ­£åœ¨åˆå§‹åŒ–ä¸–ç•Œ...</div>
            <div class="choice-buttons" id="choices-area"></div>
        </div>

        <div class="section">
            <div class="section-title">ã€æ—äººåŠ¨æ€ã€‘</div>
            <div id="log-container" style="max-height: 150px; overflow-y: auto;">
                <div class="log-entry" style="text-align:center;color:#888;">æš‚æ— è®°å½•</div>
            </div>
        </div>

        <div class="input-area">
            <input type="text" id="user-input" class="command-input" 
                   placeholder="è¾“å…¥è‡ªå®šä¹‰è¡ŒåŠ¨ (å¦‚ï¼šå»æ²³è¾¹æ‰¾æ°´)..." 
                   onkeypress="if(event.key==='Enter') Game.sendInput(this.value)">
        </div>
    </div>

    <script>
        const Config = {
            sysPrompt: `ä½ æ˜¯ä¸€ä¸ªåŸºäºæ–‡æœ¬çš„RPGæ¸¸æˆå¼•æ“ï¼ŒèƒŒæ™¯ä¸ºæ˜æœ«å´‡ç¥¯åä¸‰å¹´é€ƒè’ã€‚
            
            ã€æ•°å€¼å¹³è¡¡é“å¾‹ã€‘
            1. **è´§å¸ä»·å€¼**ï¼š1ä¸¤é“¶å­ = 1000æ–‡ã€‚ä¹è®¨/æ‹¾è’é€šå¸¸åªèƒ½è·å¾— 0.01-0.05ä¸¤ã€‚
            2. **ç²®é£Ÿä»·å€¼**ï¼š1æ–¤ç±³æ˜¯ä¿å‘½çš„ã€‚ä¸è¦åŠ¨ä¸åŠ¨å°±å¥–åŠ± 10æ–¤ã€50æ–¤ã€‚æŒ–é‡èœé€šå¸¸è·å¾— 0.5-2.0æ–¤ã€‚
            3. **ç”Ÿå‘½æ¶ˆè€—**ï¼šæ¯å¤©è‡ªç„¶æµé€ä¼šè‡ªåŠ¨å‘ç”Ÿï¼Œå¦‚æœç©å®¶é€‰æ‹©"ä¸‹ä¸€æ—¥"ï¼Œ**å¿…é¡»**åœ¨statsä¸­æ‰£é™¤å…¨å®¶(4å£äºº)å£ç²®çº¦ 2.0-3.0æ–¤ã€‚
            4. **æ•°å€¼æ³¢åŠ¨**ï¼šéè‡´æ­»äº‹ä»¶ï¼ŒHPå˜åŒ–å¹…åº¦æ§åˆ¶åœ¨ 1-5 ä¹‹é—´ã€‚å‹åŠ›å˜åŒ– 2-10 ä¹‹é—´ã€‚

            ã€è¾“å‡ºæ ¼å¼ (JSON Only)ã€‘
            {
                "narrative": "ä¸»å‰§æƒ…æ–‡æœ¬...ä¸è¦ä½¿ç”¨HTMLæ ‡ç­¾ï¼Œå¯¹è¯è¯·åŠ¡å¿…ç”¨åŒå¼•å·â€œ...â€åŒ…è£¹ã€‚",
                "logs": ["è¾°æ—¶: ...", "åˆæ—¶: ..."],
                "stats": {
                    "hp": 0,    // å˜æ›´å€¼ (+/-)
                    "stress": 0,// å˜æ›´å€¼ (+/-)
                    "grain": 0, // å˜æ›´å€¼ (+/- 0.1ç²¾åº¦)
                    "money": 0, // å˜æ›´å€¼ (+/- 0.01ç²¾åº¦)
                    "date_advance": 0 // 1 = æ¨è¿›ä¸€å¤©
                },
                "options": [
                    { "text": "A. [è¡Œä¸º] æè¿°", "cmd": "æŒ‡ä»¤" }
                ],
                "weather": "æ™´ Â· 18â„ƒ"
            }

            ã€å½“å‰çŠ¶æ€ã€‘
            ç©å®¶:[NAME],14å²ã€‚HP:[HP],ç²®:[GRAIN]æ–¤,é’±:[MONEY]ä¸¤ã€‚
            å…¨å®¶: çˆ¶(ç—…), æ¯(å¼±), å¼Ÿ(å¹¼)ã€‚
            `,
            api: { host: '', key: '', model: '' }
        };

        const State = {
            meta: { 
                name: 'é™ˆäºŒä¸«', hp: 35, stress: 70, grain: 21.5, money: 0.30, int: 62,
                dateStr: 'å´‡ç¥¯åä¸‰å¹´å››æœˆåˆä¹'
            },
            history: []
        };

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨å›å¡«ä¿å­˜çš„é…ç½®
        window.onload = function() {
            if(localStorage.getItem('th_api_host')) document.getElementById('api-host').value = localStorage.getItem('th_api_host');
            if(localStorage.getItem('th_api_key')) document.getElementById('api-key').value = localStorage.getItem('th_api_key');
            if(localStorage.getItem('th_api_model')) document.getElementById('api-model').value = localStorage.getItem('th_api_model');
            if(localStorage.getItem('th_player_name')) document.getElementById('player-name').value = localStorage.getItem('th_player_name');
        };

        const Game = {
            init() {
                const key = document.getElementById('api-key').value;
                if(!key) return alert("å®¢å®˜ï¼ŒKeyä¸èƒ½ä¸ºç©º");
                
                // ä¿å­˜é…ç½®åˆ°æœ¬åœ°
                localStorage.setItem('th_api_host', document.getElementById('api-host').value);
                localStorage.setItem('th_api_key', key);
                localStorage.setItem('th_api_model', document.getElementById('api-model').value);
                localStorage.setItem('th_player_name', document.getElementById('player-name').value);

                Config.api.key = key;
                Config.api.host = document.getElementById('api-host').value;
                Config.api.model = document.getElementById('api-model').value || 'deepseek-ai/DeepSeek-V3';
                State.meta.name = document.getElementById('player-name').value;

                document.getElementById('setup-modal').style.display = 'none';

                let prompt = Config.sysPrompt
                    .replace(/\[NAME\]/g, State.meta.name)
                    .replace('[HP]', State.meta.hp)
                    .replace('[GRAIN]', State.meta.grain)
                    .replace('[MONEY]', State.meta.money);

                State.history = [
                    { role: 'system', content: prompt },
                    { role: 'user', content: 'åˆå§‹åŒ–æ¸¸æˆã€‚æè¿°æ¸…æ™¨è¥åœ°ã€‚' }
                ];

                this.triggerAI();
            },

            async triggerAI() {
                this.setLoading(true);
                
                const statusInject = `\n(System: Current Grain=${State.meta.grain.toFixed(1)}, Money=${State.meta.money.toFixed(2)}, HP=${State.meta.hp}. Family=4 people. If advancing day, deduct ~2.5 grain. REMINDER: Respond in strict JSON.)`;
                
                // ã€æ ¸å¿ƒä¿®å¤1ï¼šä¸Šä¸‹æ–‡æ»‘åŠ¨çª—å£ã€‘
                // é˜²æ­¢ playing å¤ªä¹…å token çˆ†ç‚¸ã€‚ä¿ç•™ System(0) å’Œæœ€è¿‘ 16 æ¡å¯¹è¯
                let context = [...State.history];
                if (context.length > 18) {
                    context = [context[0], ...context.slice(-16)];
                }

                // æ·±åº¦æ‹·è´æœ€åä¸€æ¡å¹¶æ³¨å…¥çŠ¶æ€ï¼Œé˜²æ­¢æ±¡æŸ“
                const lastMsg = { ...context[context.length - 1] };
                lastMsg.content += statusInject;
                context[context.length - 1] = lastMsg;

                try {
                    const res = await fetch(`${Config.api.host}/chat/completions`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json', 'Authorization': `Bearer ${Config.api.key}` },
                        body: JSON.stringify({
                            model: Config.api.model,
                            messages: context, // å‘é€å‰ªè£åçš„ä¸Šä¸‹æ–‡
                            max_tokens: 1500,
                            temperature: 0.7,
                            response_format: { type: "json_object" }
                        })
                    });

                    const data = await res.json();
                    if(data.error) throw new Error(data.error.message);
                    const content = data.choices[0].message.content;
                    
                    State.history.push({ role: 'assistant', content: content });
                    this.processResponse(content);

                } catch (e) {
                    // å‡ºé”™æ—¶å¦‚æœä¸å›é€€ï¼Œç”¨æˆ·ä¼šè¢«å¡æ­»
                    if(State.history.length > 2 && State.history[State.history.length-1].role === 'user') {
                       // å…è®¸é‡è¯•
                    }
                    document.getElementById('main-narrative').innerHTML = `<span style="color:red">å¤©æœºæ··æ·†...è¯·é‡è¯• (${e.message})</span><br><br><small>å»ºè®®ï¼šç¼©çŸ­è¾“å…¥æˆ–æ£€æŸ¥API Keyã€‚</small>`;
                } finally {
                    this.setLoading(false);
                }
            },

            processResponse(jsonStr) {
                // ã€æ ¸å¿ƒä¿®å¤2ï¼šæ™ºèƒ½æå– JSONã€‘
                // è§£å†³ DeepSeek-R1 ç­‰æ¨¡å‹å¯èƒ½åœ¨ JSON å‰åè¾“å‡ºæ€è€ƒè¿‡ç¨‹çš„é—®é¢˜
                let cleanStr = jsonStr.trim();
                // å¯»æ‰¾ç¬¬ä¸€ä¸ª '{' å’Œæœ€åä¸€ä¸ª '}'
                const firstBrace = cleanStr.indexOf('{');
                const lastBrace = cleanStr.lastIndexOf('}');
                
                if (firstBrace !== -1 && lastBrace !== -1) {
                    cleanStr = cleanStr.substring(firstBrace, lastBrace + 1);
                }

                try {
                    const data = JSON.parse(cleanStr);
                    if(data.stats) this.updateStats(data.stats);
                    if(data.narrative) this.updateNarrative(data.narrative);
                    if(data.logs) this.renderLogs(data.logs);
                    if(data.options) this.renderChoices(data.options);
                    if(data.weather) document.getElementById('weather-display').innerText = data.weather;
                } catch (e) {
                    console.error("Parse Error", e);
                    console.log("Raw Output:", jsonStr); // æ–¹ä¾¿è°ƒè¯•
                    document.getElementById('main-narrative').innerHTML += `<br><span style="color:red;font-size:12px;">(æ•°æ®è§£æå¾®ç‘•ï¼Œä½†å‘½è¿ç»§ç»­æµè½¬)</span>`;
                }
            },

            updateNarrative(rawText) {
                const box = document.getElementById('main-narrative');
                let formattedHTML = rawText
                    .replace(/â€œ([^â€]+)â€/g, '<span class="txt-dialogue">â€œ$1â€</span>')
                    .replace(/"([^"]+)"/g, '<span class="txt-dialogue">â€œ$1â€</span>')
                    .replace(/\*\*(.*?)\*\*/g, '<span class="txt-bold">$1</span>');

                box.classList.add('fade-out');
                setTimeout(() => {
                    box.innerHTML = formattedHTML;
                    box.classList.remove('fade-out');
                    box.classList.add('fade-in');
                    box.scrollTop = 0;
                }, 300);
            },

            updateStats(diff) {
                const anim = (id, val, suffix) => {
                    if(!val || val == 0) return;
                    const displayVal = Number.isInteger(val) ? val : val.toFixed(2);
                    const el = document.getElementById(id);
                    if(!el) return;
                    const float = document.createElement('div');
                    float.className = 'float-anim';
                    float.innerText = (val > 0 ? '+' : '') + displayVal + suffix;
                    float.style.color = val > 0 ? '#558B2F' : '#8B0000';
                    const rect = el.getBoundingClientRect();
                    float.style.left = rect.left + 'px';
                    float.style.top = rect.top + 'px';
                    document.body.appendChild(float);
                    setTimeout(() => float.remove(), 2000);
                };

                if(diff.hp) { State.meta.hp = Math.max(0, Math.min(100, State.meta.hp + diff.hp)); anim('txt-hp', diff.hp, ''); }
                if(diff.grain) { State.meta.grain = parseFloat((State.meta.grain + diff.grain).toFixed(1)); anim('val-grain', diff.grain, 'æ–¤'); }
                if(diff.money) { State.meta.money = parseFloat((State.meta.money + diff.money).toFixed(2)); anim('val-money', diff.money, 'ä¸¤'); }
                if(diff.stress) { State.meta.stress = Math.max(0, Math.min(100, State.meta.stress + diff.stress)); anim('txt-stress', diff.stress, ''); }

                document.getElementById('txt-hp').innerText = State.meta.hp;
                document.getElementById('bar-hp').style.width = State.meta.hp + '%';
                document.getElementById('txt-stress').innerText = State.meta.stress;
                document.getElementById('bar-stress').style.width = State.meta.stress + '%';
                document.getElementById('val-grain').innerText = State.meta.grain.toFixed(1) + ' æ–¤';
                document.getElementById('val-money').innerText = State.meta.money.toFixed(2) + ' ä¸¤';
            },

            renderLogs(logs) {
                const container = document.getElementById('log-container');
                logs.forEach(log => {
                    const div = document.createElement('div');
                    div.className = 'log-entry';
                    div.innerHTML = log.replace(/^(.+?):/, '<span class="log-time">$1</span>');
                    container.prepend(div);
                });
            },

            renderChoices(options) {
                const area = document.getElementById('choices-area');
                area.innerHTML = '';
                options.forEach(opt => {
                    const btn = document.createElement('button');
                    btn.className = 'choice-btn';
                    btn.innerHTML = opt.text.replace(/\[(.*?)\]/g, '<b>[$1]</b>');
                    btn.onclick = () => this.sendInput(opt.cmd || opt.text);
                    area.appendChild(btn);
                });
            },

            sendInput(val) {
                if(!val.trim()) return;
                document.getElementById('user-input').value = '';
                State.history.push({ role: 'user', content: val });
                this.triggerAI();
            },

            setLoading(isLoading) {
                const mask = document.getElementById('loading-mask');
                const btns = document.querySelectorAll('.choice-btn');
                const input = document.getElementById('user-input');
                if(isLoading) {
                    mask.style.display = 'flex';
                    btns.forEach(b => b.disabled = true);
                    input.disabled = true;
                } else {
                    mask.style.display = 'none';
                    btns.forEach(b => b.disabled = false);
                    input.disabled = false;
                    input.focus();
                }
            }
        };
    </script>
</body>
</html>